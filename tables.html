<!DOCTYPE html>
<html>
<head>
    <title>Maintenance</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
        table {
            text-align: center;
        }
        #searchInput {
            width: 34.3%;
            max-width: 150px;
            display: block;
        }
        main {
            width: 50%;
        }
    </style>
</head>
<body>
    <header>
        <h1><a href="main.html" id="logo-link">Emma's Small Engines</a></h1>
        <nav id="headerContent">
            <ul>
                <li><a href="main.html">Home</a></li>
                <li style="display: none;" id="customerLink"><a href="customer.html">Customer</a></li>
                <li style="display: none;" id="repairsLink"><a href="repairs.html">Repairs</a></li>
                <li style="display: none;" id="reportsLink"><a href="reports.html">Reports</a></li>
                <li style="display: none;" id="maintenanceLink"><a href="tables.html">Maintenance</a></li>  
            </ul>
        </nav>
    </header>

    <button class="logout-button" id="logoutButton" onclick="location.href='login.html'" style="position: fixed; top: 70px; right: 10px;">Logout</button>

    <main>
        <h1>Maintenance</h1>
        <div class="center-container">
            <input type="text" id="searchInput" placeholder="Search..." oninput="filterTable()">
        </div>

        <div id="tabs">
            <button id="colorsTab" class="active" onclick="showTable('coloursTable'); updateCreateButton('Add Colour', 'coloursCreate')">Colours</button>
            <button id="citiesTab" onclick="showTable('citiesTable'); updateCreateButton('Add City', 'citiesCreate')">Cities</button>
            <button id="typesTab" onclick="showTable('typesTable'); updateCreateButton('Add Type', 'typesCreate')">Types</button>
            <button id="partsTab" onclick="showTable('partsTable'); updateCreateButton('Add Part', 'partsCreate')">Parts</button>
            <button id="brandsTab" onclick="showTable('brandsTable'); updateCreateButton('Add Brand', 'brandsCreate')">Brands</button>
        </div>

        <div id="createButtonContainer">
            <button id="createButton">Add Colour</button>
        </div>

        <table id="coloursTable" class="table" border="1">
            <thead>
                <tr>
                    <th>Colour</th>
                    <th>Controls</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <table id="citiesTable" class="table" border="1">
            <thead>
                <tr>
                    <th>City</th>
                    <th>Controls</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <table id="typesTable" class="table" border="1">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Stock</th>
                    <th>Controls</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <table id="partsTable" class="table" border="1">
            <thead>
                <tr>
                    <th>Part</th>
                    <th>Stock</th>
                    <th>Controls</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <table id="brandsTable" class="table" border="1">
            <thead>
                <tr>
                    <th>Brand</th>
                    <th>Controls</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </main>

<script>
    // Hardcoded data for the tables
const coloursData = [
    { name: 'Red' }, { name: 'Green' }, { name: 'Blue' }, 
    { name: 'Yellow' }, { name: 'Purple' }, { name: 'Pink' },
    { name: 'Orange' }, { name: 'White' }, { name: 'Brown' },
    { name: 'Grey' }, { name: 'Black' }
];

const citiesData = [
    { name: 'Niagara Falls' }, { name: 'Toronto' }, 
    { name: 'Ottawa' }, { name: 'Calgary' }, { name: 'Winnipeg' }
];

// Set fixed stock values for each part
const partsData = [
    { name: 'Bolt', stock: 50 },
    { name: 'Screw', stock: 75 },
    { name: 'Washer', stock: 100 },
    { name: 'Nut', stock: 80 },
    { name: 'Spring', stock: 60 }
];

// Set fixed stock values for each type
const typesData = [
    { name: 'Electric lawnmower', stock: 30 },
    { name: 'Gas powered lawnmower', stock: 25 },
    { name: 'Bagged lawnmower', stock: 40 },
    { name: 'Push Mower', stock: 35 },
    { name: 'Scythe', stock: 20 }
];

const brandsData = [
    { name: 'Honda' }, { name: 'Dewalt' }, { name: 'Craftsman' }, 
    { name: 'John Deere' }
];



function populateTable(tableId, data) {
    const table = document.getElementById(tableId);
    const tableBody = table.getElementsByTagName('tbody')[0];
    tableBody.innerHTML = '';

    data.forEach(item => {
        const row = tableBody.insertRow();
        const cell = row.insertCell();
        cell.textContent = item.name || item.type;

        // Add a Stock column for parts and types
        if (tableId === 'partsTable' || tableId === 'typesTable') {
            const stockCell = row.insertCell();
            stockCell.textContent = item.stock;
        }

        // Add a Controls column for editing and ordering more
        const controlsCell = row.insertCell();
        
        // Create Edit button
        const editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.style.marginRight = '10px'; // Added margin to the right of the Edit button for spacing
        editButton.onclick = function () {
            editItem(row, tableId);
        };
        controlsCell.appendChild(editButton);

        // Create Order More button (only for parts and types tables)
        if (tableId === 'partsTable' || tableId === 'typesTable') {
            const orderMoreButton = document.createElement('button');
            orderMoreButton.textContent = 'Order More';
            // Optionally, add margin for order more button if needed
            // orderMoreButton.style.marginLeft = '10px';
            orderMoreButton.onclick = function () {
                orderMorePartsOrTypes(item);
            };
            controlsCell.appendChild(orderMoreButton);
        }
    });
}


function filterTable() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const activeTableId = Array.from(document.getElementsByClassName('table active')).map(table => table.id)[0];

    let data;
    if (activeTableId === 'coloursTable') { data = coloursData; }
    else if (activeTableId === 'typesTable') { data = typesData; }
    else if (activeTableId === 'citiesTable') { data = citiesData; }
    else if (activeTableId === 'partsTable') { data = partsData; }
    else if (activeTableId === 'brandsTable') { data = brandsData; }

    const filteredData = data.filter(item => (item.name || item.type).toLowerCase().includes(searchTerm));
    populateTable(activeTableId, filteredData);
}

function showTable(tableId) {
    const tabs = document.getElementById('tabs').getElementsByTagName('button');
    for (const tab of tabs) {
        tab.classList.remove('active');
    }

    const allTables = document.getElementsByClassName('table');
    for (const table of allTables) {
        table.classList.remove('active');
    }

    document.getElementById(tableId).classList.add('active');
}

function editItem(row, tableId) {
    const rowIndex = row.rowIndex - 1;
    let editPage, rowType, data;
    if (tableId === 'coloursTable') { editPage = 'coloursEdit.html'; rowType = 'colour'; data = coloursData; }
    else if (tableId === 'typesTable') { editPage = 'typesEdit.html'; rowType = 'type'; data = typesData; }
    else if (tableId === 'citiesTable') { editPage = 'citiesEdit.html'; rowType = 'city'; data = citiesData; }
    else if (tableId === 'partsTable') { editPage = 'partsEdit.html'; rowType = 'part'; data = partsData; }
    else if (tableId === 'brandsTable') { editPage = 'brandsEdit.html'; rowType = 'brand'; data = brandsData; }

    const rowData = data[rowIndex];
    const jsonData = JSON.stringify(rowData);
    const paramName = `${rowType}Name`;
    const typeName = rowData.name || rowData.type;
    window.location.href = `${editPage}?data=${encodeURIComponent(jsonData)}&${paramName}=${encodeURIComponent(typeName)}`;
}

function updateCreateButton(buttonText, link) {
    const createButton = document.getElementById('createButton');
    createButton.textContent = buttonText;
    createButton.onclick = function () {
        window.location.href = link + '.html';
    };
}

window.onload = function () {
    populateTable('coloursTable', coloursData);
    populateTable('typesTable', typesData);
    populateTable('citiesTable', citiesData);
    populateTable('partsTable', partsData);
    populateTable('brandsTable', brandsData)
    showTable('coloursTable');
    updateCreateButton('Add Colour', 'coloursCreate');

    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', filterTable);
};

// Function for handling the order more action
function orderMoreParts(row, part) {
    // Redirect to the reportsCreate.html page
    window.location.href = 'reportsCreate.html';
}

// Function for handling the order more action for parts or types
function orderMorePartsOrTypes(row, item) {
    // Redirect to the reportsCreate.html page
    window.location.href = 'reportsCreate.html';
}

//check for roles
const userRole = sessionStorage.getItem('userRole');
    if (userRole === 'sales') {
        document.getElementById('customerLink').style.display = 'block';
    } else if (userRole === 'tech') {
        document.getElementById('repairsLink').style.display = 'block';
        document.getElementById('reportsLink').style.display = 'block';
    } else if (userRole === 'admin') {
        document.getElementById('customerLink').style.display = 'block';
        document.getElementById('maintenanceLink').style.display = 'block';
        document.getElementById('reportsLink').style.display = 'block';
        document.getElementById('repairsLink').style.display = 'block';
    } else {
        // Redirect to login page if user role is not set
        window.location.href = 'main.html';
    }
</script>

</body>
</html>
